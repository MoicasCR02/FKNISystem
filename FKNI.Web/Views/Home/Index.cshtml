@model FKNI.Web.ViewModels.HomeViewModel
@{
    ViewData["Title"] = "Inicio";
}

<!-- VIDEO DE FONDO GLOBAL (detrás de todo) -->
<video autoplay muted loop playsinline
       class="position-fixed top-0 start-0 w-100 h-100"
       style="object-fit: cover; z-index:-1; pointer-events:none;">
    <source src="@Url.Content("~/videos/sk8.mp4")" type="video/mp4">
    Tu navegador no soporta videos en HTML5.
</video>

<!-- Overlay para contraste del texto -->
<div class="position-fixed top-0 start-0 w-100 h-100"
     style="background: rgba(0,0,0,0.35); z-index:-1; pointer-events:none;"></div>

<!-- HERO -->
<section class="section bg-transparent text-white">
    <div class="container container-narrow">
        <header class="text-center py-6">
            <h1 class="section-title mb-3">Fucking Industry</h1>
            <p class="section-subtitle">Camisetas con actitud, diseño y materiales que respetan el planeta.</p>
            <div class="mt-4">
                <a asp-controller="Productos" asp-action="Index" class="btn btn-light btn-lg">
                    <i class="bi bi-bag-heart me-2"></i> Ver catálogo
                </a>
            </div>
        </header>
    </div>
</section>

<!-- CARRUSEL (Destacados) -->
@if (Model.Destacados.Any())
{
    <section class="section pt-0">
        <div class="container">
            <div class="card shadow-md overflow-hidden">
                <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
                    <!-- Indicadores -->
                    <div class="carousel-indicators">
                        @for (int i = 0; i < Model.Destacados.Count; i++)
                        {
                            <button type="button"
                                    data-bs-target="#heroCarousel"
                                    data-bs-slide-to="@i"
                                    class="@(i == 0 ? "active" : "")"
                                    aria-label="Slide @(i + 1)"></button>
                        }
                    </div>

                    <!-- Slides -->
                    <div class="carousel-inner">
                        @for (int i = 0; i < Model.Destacados.Count; i++)
                        {
                            var p = Model.Destacados[i];
                            var img = string.IsNullOrWhiteSpace(p.ImagenUrl)
                            ? "https://source.unsplash.com/1600x900/?tshirt,apparel"
                            : p.ImagenUrl;

                            <div class="carousel-item @(i == 0 ? "active" : "")">
                                <div class="position-relative">
                                    <img class="d-block w-100"
                                         style="object-fit:cover; height: 520px;"
                                         src="@img"
                                         alt="@p.Nombre"
                                         onerror="this.onerror=null;this.src='https://source.unsplash.com/1600x900/?tshirt,apparel';" />

                                    <div class="position-absolute start-0 bottom-0 p-4 w-100"
                                         style="background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(22,22,22,.65) 70%);">
                                        <div class="text-white">
                                            <h3 class="mb-1">@p.Nombre</h3>
                                            @if (!string.IsNullOrWhiteSpace(p.DescripcionCorta))
                                            {
                                                <p class="mb-3">@p.DescripcionCorta</p>
                                            }
                                            <div class="d-flex align-items-center gap-2">
                                                @if (p.TienePromo)
                                                {
                                                    <span class="badge bg-terracotta">
                                                        <i class="bi bi-lightning-charge me-1"></i> Promo
                                                    </span>
                                                    <div class="fs-5">
                                                        <span class="text-decoration-line-through opacity-75 me-2">₡@p.Precio.ToString("N2")</span>
                                                        <span class="fw-bold">₡@p.PrecioConPromo?.ToString("N2")</span>
                                                    </div>
                                                }
                                                else
                                                {
                                                    <div class="fs-5 fw-bold">₡@p.Precio.ToString("N2")</div>
                                                }
                                            </div>
                                        </div>
                                    </div>

                                    <div class="position-absolute start-0 top-0 p-3">
                                        <span class="badge bg-dark rounded-pill">Destacado</span>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    <!-- Controles -->
                    <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Anterior</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Siguiente</span>
                    </button>
                </div>
            </div>
        </div>
    </section>
}

<!-- FEATURES -->
<section class="section">
    <div class="container">
        <div class="row g-4 text-center">
            <div class="col-md-4">
                <div class="card p-4 np-hover-lift h-100">
                    <div class="feature-icon bg-brown text-white mx-auto mb-3"><i class="bi bi-brush"></i></div>
                    <h4>Diseños Exclusivos</h4>
                    <p>Colecciones originales creadas por <strong>Moicas</strong>. Sé diferente.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card p-4 np-hover-lift h-100">
                    <div class="feature-icon bg-terracotta text-white mx-auto mb-3">
                        <i class="bi bi-tree-fill"></i>
                    </div>
                    <h4>Eco-Friendly</h4>
                    <p>Fibras y procesos sostenibles, menos impacto y más estilo.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card p-4 np-hover-lift h-100">
                    <div class="feature-icon bg-nude text-black mx-auto mb-3"><i class="bi bi-truck"></i></div>
                    <h4>Envío Rápido</h4>
                    <p>Recibe tu favorita en tiempo récord, en todo el país.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- MINI-GRID (Recientes) -->
@if (Model.Recientes.Any())
{
    <section class="section pt-0">
        <div class="container">
            <h3 class="mb-3 text-center">Lo último de la tienda</h3>
            <div class="row g-3">
                @foreach (var p in Model.Recientes)
                {
                    var thumb = string.IsNullOrWhiteSpace(p.ImagenUrl)
                    ? "https://source.unsplash.com/600x600/?tshirt,streetwear"
                    : p.ImagenUrl;

                    <div class="col-6 col-md-3">
                        <a asp-controller="Productos" asp-action="Details" asp-route-id="@p.Id"
                           class="d-block ratio ratio-1x1 card overflow-hidden np-hover-lift">
                            <img class="w-100 h-100"
                                 style="object-fit: cover;"
                                 src="@thumb"
                                 alt="@p.Nombre"
                                 onerror="this.onerror=null;this.src='https://source.unsplash.com/600x600/?tshirt,streetwear';" />
                        </a>
                        <div class="pt-2 text-center">
                            <div class="fw-semibold">@p.Nombre</div>
                            @if (p.TienePromo)
                            {
                                <div class="small">
                                    <span class="text-decoration-line-through opacity-75 me-2">₡@p.Precio.ToString("N2")</span>
                                    <span class="fw-bold text-brown">₡@p.PrecioConPromo?.ToString("N2")</span>
                                </div>
                            }
                            else
                            {
                                <div class="small fw-bold">₡@p.Precio.ToString("N2")</div>
                            }
                        </div>
                    </div>
                }
            </div>

            <div class="text-center mt-4">
                <a asp-controller="Productos" asp-action="Index" class="btn btn-outline-dark">
                    <i class="bi bi-grid-3x3-gap me-1"></i> Ver todo
                </a>
            </div>
        </div>
    </section>
}

<!-- Fallback global por si alguna imagen falla en runtime -->
<script>
    document.addEventListener('error', function (e) {
      const el = e.target;
      if (el.tagName === 'IMG' && !el.dataset.fallbackUsed) {
        el.dataset.fallbackUsed = 'true';
        el.src = 'https://source.unsplash.com/800x800/?tshirt,apparel';
      }
    }, true);
</script>
